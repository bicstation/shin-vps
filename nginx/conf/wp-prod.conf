server {
    listen 80;
    server_name localhost;
    root /var/www/html;
    index index.php index.html index.htm;

    # 1. æ°¸ç¶šçš„ãªã‚¢ã‚¯ã‚»ã‚¹ã¨ç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹ã‚’å‡¦ç†
    # ğŸš¨ æ¨™æº–çš„ãª WordPress è¨­å®š: ãƒ•ã‚¡ã‚¤ãƒ«ã¾ãŸã¯ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã‘ã‚Œã°ã€
    # å…¨ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ /index.php?$args ã«æ¸¡ã™ã€‚
    location / {
        try_files $uri $uri/ /index.php?$args;
    }

    # 2. PHPãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç† (WP-APIã¨ç®¡ç†ç”»é¢å«ã‚€)
    location ~ \.php$ {
        # ã‚µãƒ¼ãƒ“ã‚¹åã¯ docker-compose.yml ã®å®šç¾©ã¨ä¸€è‡´ã•ã›ã‚‹
        fastcgi_pass wordpress-v2-prod:9000;
        fastcgi_index index.php;
        
        # å…ˆã«èª­ã¿è¾¼ã‚€
        include fastcgi_params;
        
        # ğŸš¨ ã“ã“ã§ä¸Šæ›¸ããƒ»è¿½åŠ ã™ã‚‹
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        
        # TraefikãŒå‰Šã£ãŸ /blog ã‚’å¾©æ´»ã•ã›ã¦WordPressã«ä¼ãˆã‚‹
        fastcgi_param REQUEST_URI /blog$request_uri;
        
        # Hostãƒ˜ãƒƒãƒ€ãƒ¼
        fastcgi_param HTTP_HOST $http_host; 
        
        # å†…éƒ¨ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒ—ã‚’é˜²ããŸã‚ã€ã“ã“ã§ã¯ try_files ã‚’ä½¿ã‚ãš 
        # ã‚‚ã—ãƒ•ã‚¡ã‚¤ãƒ«ãŒãªã‘ã‚Œã° fastcgi å´ã§ã‚¨ãƒ©ãƒ¼ã‚’å‡ºã™ã‚ˆã†ã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™
    }
    # 3. é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|woff|woff2|ttf|eot|svg)$ {
        expires 30d;
        log_not_found off;
    }

    # 4. Gitã‚„éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ‹’å¦
    location ~ /\. {
        deny all;
    }
}