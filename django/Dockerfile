#!/bin/sh
# Pythonå…¬å¼ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨
FROM python:3.11-slim

# OSã®ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆpsycopg2ã«å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ncã‚³ãƒãƒ³ãƒ‰ï¼‰
# --- å¤‰æ›´ç®‡æ‰€: netcat-openbsd ã‚’è¿½åŠ ã—ã¾ã—ãŸ ---
RUN apt-get update && apt-get install -y \
    libpq-dev \
    gcc \
    netcat-openbsd \
    && rm -rf /var/lib/apt/lists/*
# --------------------------------------------------

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®è¨­å®š
WORKDIR /usr/src/app

# requirements.txtã‚’ã‚³ãƒ”ãƒ¼ã—ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Djangoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«ã‚³ãƒ”ãƒ¼
COPY . .

# --------------------------------------------
# ğŸ¯ è¿½è¨˜ã™ã‚‹é‡è¦ãªè¡Œ: entrypoint.sh ã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
RUN chmod +x /usr/src/app/entrypoint.sh
# --------------------------------------------

# Djangoã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆï¼ˆGunicornã§ä½¿ç”¨ï¼‰
EXPOSE 8000

# ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•æ™‚ã«Gunicornã‚’èµ·å‹•
CMD ["gunicorn", "your_project.wsgi:application", "--bind", "0.0.0.0:8000"]