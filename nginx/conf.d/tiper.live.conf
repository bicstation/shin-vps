server {
    listen 80;
    
    # ğŸ’¡ ä¿®æ­£: server_name ã« localhost ã‚’è¿½åŠ  (ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚)
    server_name blog.tiper.live tiper.live localhost host.docker.internal; 

    # ğŸš¨ æ¥ç¶šã®å®‰å®šåŒ–ã®ãŸã‚ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šã‚’ç¶­æŒ
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;

    # 1. ğŸ’° Next.js - next-bic-saving ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    # ã€Savingã€‘ç¯€ç´„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    location /saving/ {
        # ğŸ’¡ ä¿®æ­£: UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š (æ–‡å­—åŒ–ã‘è§£æ¶ˆ)
        add_header Content-Type "text/html; charset=utf-8";
        
        # ã‚µãƒ¼ãƒ“ã‚¹å: next-bic-saving, ãƒãƒ¼ãƒˆ: 3000
        proxy_pass http://next-bic-saving:3000/;
        
        # ãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 2. ğŸ“ Next.js - next-tiper ã‚µãƒ¼ãƒ“ã‚¹ã¸ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    # ã€Tiperã€‘ã‚µãƒ¼ãƒ“ã‚¹æ©Ÿèƒ½ç´¹ä»‹
    location /tiper/ {
        # ğŸ’¡ ä¿®æ­£: UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š (æ–‡å­—åŒ–ã‘è§£æ¶ˆ)
        add_header Content-Type "text/html; charset=utf-8";

        # ã‚µãƒ¼ãƒ“ã‚¹å: next-tiper, ãƒãƒ¼ãƒˆ: 3000
        proxy_pass http://next-tiper:3000/;
        
        # ãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 3. ğŸ’¡ ãƒ«ãƒ¼ãƒˆï¼ˆ/ï¼‰ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ Next.js ãƒ¡ã‚¤ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«è»¢é€
    # ã€ãƒˆãƒƒãƒ—ã€‘bicstation ãƒ¡ã‚¤ãƒ³ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
    location / {
        # ğŸ’¡ ä¿®æ­£: UTF-8ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š (æ–‡å­—åŒ–ã‘è§£æ¶ˆ)
        add_header Content-Type "text/html; charset=utf-8";
        
        # ğŸš¨ Next.js ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆnext-bicstation ã‚’ãƒ«ãƒ¼ãƒˆã¨ã—ã¾ã™ï¼‰
        proxy_pass http://next-bicstation:3000;
        
        # ãƒ›ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®š
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}