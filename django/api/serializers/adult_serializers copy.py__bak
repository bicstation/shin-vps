# -*- coding: utf-8 -*-
from rest_framework import serializers
from api.models import (
    AdultProduct, LinkshareProduct, AdultAttribute, 
    FanzaProduct, Author
)
# å‰é …ã§ä½œã£ãŸãƒã‚¹ã‚¿ãƒ¼ç”¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’å†åˆ©ç”¨
from .master_serializers import (
    MakerSerializer, LabelSerializer, DirectorSerializer,
    SeriesSerializer, GenreSerializer, ActressSerializer, AuthorSerializer,
    AdultAttributeSerializer  # â† ã“ã‚Œã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦å…±é€šåŒ–
)

# --------------------------------------------------------------------------
# 1. FANZA æœ€é©åŒ–å•†å“ (FanzaProduct) ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
# --------------------------------------------------------------------------

class FanzaProductSerializer(serializers.ModelSerializer):
    """
    FANZA APIã®å…¨ãƒ•ãƒ­ã‚¢ã€è¤‡é›‘ãªä¾¡æ ¼ã€é«˜ç”»è³ªå‹•ç”»ã«å¯¾å¿œã—ãŸã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã€‚
    """
    maker = MakerSerializer(read_only=True)
    label = LabelSerializer(read_only=True)
    director = DirectorSerializer(read_only=True)
    series = SeriesSerializer(read_only=True)
    genres = GenreSerializer(many=True, read_only=True)
    actresses = ActressSerializer(many=True, read_only=True)
    authors = AuthorSerializer(many=True, read_only=True)

    # JSONField ã®æ˜ç¤ºçš„ãªå±•é–‹
    price_info = serializers.JSONField(required=False, allow_null=True)
    image_urls = serializers.JSONField(required=False, allow_null=True)
    sample_images = serializers.JSONField(required=False, allow_null=True)
    sample_movie = serializers.JSONField(required=False, allow_null=True)
    radar_chart_data = serializers.JSONField(required=False, allow_null=True)

    class Meta:
        model = FanzaProduct
        fields = (
            'id', 'unique_id', 'content_id', 'product_id',
            'site_code', 'service_code', 'floor_code', 'floor_name',
            'title', 'url', 'affiliate_url', 'release_date', 'volume',
            'price_info', 'review_count', 'review_average',
            'image_urls', 'sample_images', 'sample_movie',
            'maker', 'label', 'series', 'director', 'genres', 'actresses', 'authors',
            'product_description', 'ai_summary',
            'score_visual', 'score_story', 'score_cost', 'score_erotic', 'score_rarity',
            'radar_chart_data', 'is_active', 'is_recommend', 'created_at', 'updated_at'
        )
        read_only_fields = ('id', 'unique_id', 'content_id', 'created_at', 'updated_at')


# --------------------------------------------------------------------------
# 2. ã‚¢ãƒ€ãƒ«ãƒˆå•†å“ (AdultProduct) ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
# --------------------------------------------------------------------------

class AdultProductSerializer(serializers.ModelSerializer): 
    """DUGAã€æ—§FANZAãƒ‡ãƒ¼ã‚¿ã€AIãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ç”¨ã®æ±ç”¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼"""
    maker = MakerSerializer(read_only=True)
    label = LabelSerializer(read_only=True)
    director = DirectorSerializer(read_only=True)
    series = SeriesSerializer(read_only=True) 
    genres = GenreSerializer(many=True, read_only=True)
    actresses = ActressSerializer(many=True, read_only=True)
    # ğŸ†• master_serializers ã® AdultAttributeSerializer ã‚’ä½¿ã†ã‚ˆã†å¤‰æ›´
    attributes = AdultAttributeSerializer(many=True, read_only=True)

    image_url_list = serializers.JSONField(required=False, allow_null=True)
    sample_movie_url = serializers.JSONField(required=False, allow_null=True)
    
    class Meta:
        model = AdultProduct 
        fields = (
            'id', 'product_id_unique', 'title', 'product_description',
            'release_date', 'affiliate_url', 'price', 
            'image_url_list', 'sample_movie_url',
            'api_source',
            'maker', 'label', 'director', 'series', 'genres', 'actresses',
            'attributes',
            'ai_content', 'ai_summary', 'target_segment',
            'score_visual', 'score_story', 'score_cost', 
            'score_erotic', 'score_rarity', 'spec_score',
            'is_active', 'is_posted', 'last_spec_parsed_at', 'updated_at',
        )
        read_only_fields = ('id', 'product_id_unique', 'updated_at')


# --------------------------------------------------------------------------
# 3. Linkshareå•†å“ ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
# --------------------------------------------------------------------------

class LinkshareProductSerializer(serializers.ModelSerializer):
    """ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆï¼ˆç‰©è²©ç³»ç­‰ï¼‰ç”¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼"""
    class Meta:
        model = LinkshareProduct 
        fields = (
            'id', 'sku', 'product_name', 'availability', 
            'affiliate_url', 'image_url', 'merchant_id', 'updated_at',
        )
        read_only_fields = ('id', 'updated_at')